fs = require 'fs'
Hogan = require 'hogan.js'

getTemplates = (baseDir) ->
    templates = []
    exportTemplate = Hogan.compile fs.readFileSync(__dirname + "/templates.js.mustache", "utf8")

    getDirFiles = (dir) -> fs.readdirSync dir

    fetchTemplates = (dir) ->
        for file in getDirFiles dir
            if file.substr(file.length - 5) is '.html'

                path = dir + '/' + file
                ns = path
                .replace(baseDir, '')
                .substr(1)
                .replace('.html', '')
                template = Hogan.compile fs.readFileSync(path, "utf8"), { asString: true }

                templates.push { file: path, ns: ns, template: template }

            else fetchTemplates "#{dir}/#{file}" 

    fetchTemplates baseDir
    if templates.length isnt 0 then templates[templates.length - 1].last = true
    return exportTemplate.render({ templates: templates })

exports.getTemplates = getTemplates